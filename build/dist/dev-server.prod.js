"use strict";var config=require("../config");process.env.NODE_ENV||(process.env.NODE_ENV=JSON.parse(config.dev.env.NODE_ENV));var path=require("path"),express=require("express"),webpack=require("webpack"),opn=require("opn"),proxyMiddleware=require("http-proxy-middleware"),webpackConfig=require("./webpack.dev.conf"),port=process.env.PORT||config.dev.port,server=express(),compiler=webpack(webpackConfig),devMiddleware=require("webpack-dev-middleware")(compiler,{publicPath:webpackConfig.output.publicPath,stats:{colors:!0,chunks:!1}}),hotMiddleware=require("webpack-hot-middleware")(compiler);compiler.plugin("compilation",function(e){e.plugin("html-webpack-plugin-after-emit",function(e,r){hotMiddleware.publish({action:"reload"}),r()})});var context=config.dev.context;switch(process.env.NODE_ENV){case"local":var proxypath="http://localhost:8001";break;case"online":proxypath="http://elm.cangdu.org";break;default:proxypath=config.dev.proxypath}var options={target:proxypath,changeOrigin:!0};context.length&&server.use(proxyMiddleware(context,options)),server.use(require("connect-history-api-fallback")()),server.use(devMiddleware),server.use(hotMiddleware);var staticPath=path.posix.join(config.dev.assetsPublicPath,config.dev.assetsSubDirectory);server.use(staticPath,express.static("./static")),module.exports=server.listen(port,function(e){if(e)console.log(e);else{var r="http://localhost:"+port;console.log("Listening at "+r+"\n"),"testing"!==process.env.NODE_ENV&&opn(r)}});